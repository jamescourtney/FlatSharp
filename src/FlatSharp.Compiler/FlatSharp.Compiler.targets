<?xml version="1.0" encoding="utf-8" ?>
<Project>
  <Target Name="FlatSharpFbsCompile" AfterTargets="BeforeBuild">
    <PropertyGroup Condition=" '$(TargetFrameworkIdentifier)' != '.NETFramework' ">
      <CompilerPath>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)\..\..\tools\netcoreapp2.1\FlatSharp.Compiler.dll'))</CompilerPath>
      <CompilerInvocation>dotnet $(CompilerPath)</CompilerInvocation>
    </PropertyGroup>

    <PropertyGroup Condition=" '$(TargetFrameworkIdentifier)' == '.NETFramework' ">
      <CompilerPath>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)\..\..\tools\net47\FlatSharp.Compiler.exe'))</CompilerPath>
      <CompilerInvocation>$(CompilerPath)</CompilerInvocation>
    </PropertyGroup>

    <Message Text="$(CompilerInvocation) %(FBS.fullpath)" Importance="high" />
    <Exec Command="$(CompilerInvocation) %(FBS.fullpath)" CustomErrorRegularExpression=".*" />
  </Target>
</Project>